---
import '../styles/global.css';
import Header from '../components/Header.astro';
import BackgroundCanvas from '../components/BackgroundCanvas.astro';
import Seo from '../components/Seo.astro';
import { getLangFromUrl, useTranslations } from '../i18n/utils';

interface Props {
	title?: string;
	description?: string;
	image?: string;
	theme?: 'light' | 'dark';
	structuredData?: Record<string, unknown>;
	noIndex?: boolean;
}

const lang = getLangFromUrl(Astro.url);
const t = useTranslations(lang);

const {
	title = 'Horde',
	description = t('site.description'),
	image = '/meta.jpg',
	theme = 'light',
	structuredData,
	noIndex = false
} = Astro.props;

const resolvedImage = image.startsWith('http')
	? image
	: Astro.site
		? new URL(image, Astro.site).toString()
		: image;

const defaultStructuredData = {
	'@context': 'https://schema.org',
	'@type': 'Organization',
	name: 'Horde',
	url: Astro.site?.toString() ?? 'https://www.hordeagence.com',
	logo: resolvedImage,
	sameAs: ['https://www.linkedin.com'],
	contactPoint: [
		{
			'@type': 'ContactPoint',
			contactType: 'Service client',
			telephone: '+32487479798',
			email: 'hello@hordeagence.com',
			availableLanguage: ['fr', 'en']
		}
	]
};

const schema = structuredData ?? defaultStructuredData;
const themeClass = theme === 'dark' ? 'bg-fonddark text-white [&_svg]:fill-white' : 'bg-fond text-fonddark [&_svg]:fill-fonddark';
---

<!doctype html>
<html lang={lang}>
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<link rel="icon" type="image/svg+xml" href="/favicon.svg" />
		<link rel="preload" href="/src/assets/fonts/PPEditorialNew-Ultralight.ttf" as="font" type="font/ttf" crossorigin />
		<link rel="preload" href="/src/assets/fonts/PPFraktionSans-Variable.ttf" as="font" type="font/ttf" crossorigin />
		<meta name="generator" content={Astro.generator} />
		<meta name="theme-color" content={theme === 'dark' ? '#101010' : '#f1f1f1'} />
		<Seo title={title} description={description} image={resolvedImage} noIndex={noIndex} />
		{schema && (
			<script type="application/ld+json">
				{JSON.stringify(schema)}
			</script>
		)}
	</head>
	<body class={themeClass}>
		<Header></Header>
		<span class=`${theme === 'dark' ? 'bg-outlinedark' : 'bg-outline'} hidden xl:block fixed h-full w-px top-0 left-(--line-margin) -z-10000`></span>
		<span class=`fixed h-full w-px md:w-10 md:border-x top-0 left-(--line-margin) xl:left-[calc(2*var(--line-margin))] ${theme === 'dark' ? 'bg-outlinedark md:border-outlinedark' : 'bg-outline md:border-outline'} md:bg-transparent -z-10000`></span>
		<slot />
		<span class=`fixed h-full w-px md:w-10 md:border-x top-0 right-(--line-margin) xl:right-[calc(2*var(--line-margin))] ${theme === 'dark' ? 'bg-outlinedark md:border-outlinedark' : 'bg-outline md:border-outline'} md:bg-transparent -z-10000`></span>
		<span class=`${theme === 'dark' ? 'bg-outlinedark' : 'bg-outline'} hidden xl:block fixed h-full w-px top-0 right-(--line-margin) -z-10000`></span>

	</body>
</html>

<script>
	import Lenis from 'lenis';

	const lenis = new Lenis();

	function raf(time: number) {
		lenis.raf(time);
		requestAnimationFrame(raf);
	}

	requestAnimationFrame(raf);
</script>
